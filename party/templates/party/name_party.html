<!DOCTYPE html>

{% extends "base.html" %}
{% block settings %}
<style>
	.device{
		font-size: 24px;
	}
</style>

<script>

	$(document).ready(function() {
		setDeviceIcon('{{device.active}}'=='True','{{device.type}}', '{{device.name}}');
	});
	var inactivity = false;

		setInterval(function () {
			if (!inactivity){
				$.ajax({
					url: '/party/update_set_device',
					data: {
					'pid': {{ party.pk }}
					},
					dataType: 'json',
					success: function (data) {
						setDeviceIcon(data.device.active, data.device.type, data.device.name)
						inactivity = data.stop;
					}
				});
			}
		}, 1000);

		function setActiveProperties(active, type, name){
			var submit = document.getElementById("submit");
			var device_name = document.getElementById("name");
			var message = document.getElementById('message');
			var icon = document.getElementById('device');
			var c = getIconClass(type);
			icon.className = '';
			icon.classList.add('device', c['glyph'], c['sub']);
			if(active){
				icon.style.color = '#1ed760';
				submit.disabled = false;
				submit.classList.add('btn-outline-primary');
				submit.classList.remove('btn-outline-secondary');
				message.style.display = 'none';
			}
			else{
				icon.style.color = 'gray';
				submit.disabled = true;
				submit.classList.add('btn-outline-secondary');
				submit.classList.remove('btn-outline-primary');
				message.style.display = 'block';
			}
			device_name.innerHTML = name;
		}

		function setDeviceCard(active, type, name){
			var device_name = document.getElementById("name");
			var message = document.getElementById('message');
			var icon = document.getElementById('device');
			var c = getIconClass(type);
			icon.className = '';
			icon.classList.add('device', c['glyph'], c['sub']);
			if(active){
				icon.style.color = '#1ed760';
				message.style.display = 'none';
			}
			else{
				icon.style.color = 'gray';
				message.style.display = 'block';
			}
			device_name.innerHTML = name;
		}

		function setDeviceIcon(active, type, name){
			
			var icon = document.getElementById('device');
			var c = getIconClass(type);
			icon.className = '';
			icon.classList.add('device', c['glyph'], c['sub']);
			if(active){
				icon.style.color = '#1ed760';
			}
			else{
				icon.style.color = 'red';
			}
		}


		function getIconClass(type){
			sub = "fas";
			if (type == null || type == 'None'){
				glyph = "fa-exclamation-circle";
			}
			else if(type =="smartphone" ){
				glyph = "fa-mobile-alt";
			}
			else if(type =="tablet" ){
				glyph = "fa-tablet-alt";
			}
			else if(type =="computer" ){
				glyph = "fa-desktop";
			}
			else if(type =="castvideo" ){
				glyph = "fa-chromecast";
				sub="fab";
			}
			else if(type =="tv" ){
				glyph = "fa-tv";
			}
			else{
				glyph = "fa-spotify";
				sub = "fab";
			}
			return {glyph:glyph, sub:sub};
		}
</script>


<a href="{% url 'settings' pid=party.id %}"><em id="device" class="device"></em></a>
{% endblock %}


{% block page_content %}
	<div class = "container">
		<form action="" method="post">
			{% csrf_token %}
			<h6>{{ form.party_name.label }}</h6>
			{{ form.party_name }}
			<div class = "pt-2">
				<h6>{{ form.user_name.label }}</h6>
				{{ form.user_name }}
			</div>
			<div class = "pt-2 text-right">
				<input type="submit" class="btn btn-outline-primary" value="Submit">
			</div>
		</form>	
	</div>
{% endblock %}
